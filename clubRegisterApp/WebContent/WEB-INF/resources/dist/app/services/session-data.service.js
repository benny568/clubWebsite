System.register(["@angular/core","@angular/http","../services/logger.service","../dao/site-user","../dao/server-mode","../dao/team","../dao/member"],function(e,t){"use strict";var r,s,o,n,i,a,m,u,d,h,c,l=(t&&t.id,this&&this.__decorate||function(e,t,r,s){var o,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(i=(n<3?o(i):n>3?o(t,r,i):o(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i}),p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=this&&this.__param||function(e,t){return function(r,s){t(r,s,e)}};return{setters:[function(e){r=e,s=e},function(e){o=e,n=e,i=e},function(e){a=e},function(e){m=e},function(e){u=e},function(e){d=e},function(e){h=e}],execute:function(){c=function(){function e(e,t){this.lg$=e,this._http=t,this.modes={LOCAL:0,REMOTE:1},this.dsTeamMembers=[],this.logdepth=3,this.loghdr="",this.serviceName="SessionDataService",this.displayMember=!1,this.gAuthenticated=!1,this.loghdr=this.setLogHdr(this.logdepth,this.serviceName);var r=new u.ServerMode;this.CurrentServerMode=r.getServerMode(),this.dsAuthenticated=!1,this.dsPosition=["Manager","Goalkeeper","Full Back","Center Half","Mid Field","CAM","Winger","Striker","Chairman","Secretary","Treasurer","PRO","Committee"],this.dsCurrentUser=new m.User,this.dsCurrentTeam=new d.Team,this.dsCurrentMember=new h.Member,this.dsTeams=new Array,this.dsCurrentUser=new m.User,this.dsAllMembers=new Array,this.dsNewsStories=new Array,this.dsSponsors=new Array}return e.prototype.setCurrentMember=function(e){console.log("-->setCurrentMember()"),this.dsCurrentMember=e,this.displayMember=!0},e.prototype.hasPermission=function(e,t){var r="",s=!1,o=0;if(console.log("-->hasPermission("+e+","+t+")"),void 0===typeof e||void 0===t)return!1;for(var n=0;n<this.dsCurrentUser.roles.length;n++)if("ROLE_SUPER"===this.dsCurrentUser.roles[n])return console.log(" -> hasPermission("+e+"): YES"),!0;switch(e){case"MANAGE_TEAM":r=t;for(var i=0;i<this.dsCurrentUser.permissions.teams.length;i++){for(var a=0;a<this.dsTeams.length;a++)if(this.dsTeams[a].id===this.dsCurrentUser.permissions.teams[i]){o=a;break}if(this.dsTeams[o].name===r&&0==this.dsCurrentUser.permissions.positions[i]){s=!0;break}}break;case"ADD_TEAM":case"EDIT_TEAM":for(var n=0;n<this.dsCurrentUser.roles.length;n++){if("ROLE_SUPER"===this.dsCurrentUser.roles[n]){s=!0;break}if("ROLE_EDIT_TEAM"===this.dsCurrentUser.roles[n]){s=!0;break}}break;case"DEL_TEAM":for(var n=0;n<this.dsCurrentUser.roles.length;n++){if("ROLE_SUPER"===this.dsCurrentUser.roles[n]){s=!0;break}if("ROLE_DEL_TEAM"===this.dsCurrentUser.roles[n]){s=!0;break}}break;case"ADD_USER":case"EDIT_USER":case"DELETE_USER":case"VIEW_USERS":for(var n=0;n<this.dsCurrentUser.roles.length;n++)if("ROLE_SUPER"===this.dsCurrentUser.roles[n]){s=!0;break}}return s},e.prototype.difference=function(e,t){var r=!1;return Object.getOwnPropertyNames(e).forEach(function(s,o,n){e[s]!=t[s]&&(r=!0)}),r},e.prototype.applyMemberChange=function(t,r){var s=e.findMemberIndex(t,r);s!==-1&&(t[s].name=r.name,t[s].address=r.address,t[s].phone=r.phone,t[s].dob=r.dob,t[s].email=r.email,t[s].amount=r.amount,t[s].team=r.team,t[s].position=r.position,t[s].lid=r.lid,t[s].favteam=r.favteam,t[s].favplayer=r.favplayer,t[s].sappears=r.sappears,t[s].sassists=r.sassists,t[s].sgoals=r.sgoals,t[s].photo=r.photo,t[s].achievments=r.achievments)},e.prototype.applyMemberDel=function(t,r){var s=e.findMemberIndex(t,r);s!==-1&&s>-1&&t.splice(s,1)},e.prototype.applyMemberAdd=function(t,r){if(void 0===this.dsTeamMembers[r.team])var s=e.findMemberIndex(this.dsTeamMembers[r.team],r);s===-1&&t[r.team].push(r)},e.prototype.applyTeamChange=function(e,t){var r=-1;0===this.dsTeams.length&&this.dsGetTeams();for(var s=0;s<this.dsTeams.length;s++)if(this.dsTeams[s].id===t.id){r=s;break}r===-1||r>-1&&(this.dsTeams[r]=t)},e.findMemberIndex=function(e,t){var r=-1;if(void 0!==typeof e)for(var s=0;s<e.length;s++)if(e[s].id===t.id){r=s;break}return r},e.prototype.convertPosToInt=function(e){return this.dsPosition.indexOf(e)},e.prototype.convertTeamToInt=function(e){for(var t=0;t<this.dsTeams.length;t++)if(this.dsTeams[t].name==e)return this.dsTeams[t].id;return 0},e.prototype.setCurrentTeamByName=function(e){console.log("-->setCurrentTeamByName("+e+")"),this.dsTeams.length<1&&this.dsGetTeams();for(var t=0,r=this.dsTeams;t<r.length;t++){var s=r[t];if(s.name==e){this.dsCurrentTeam=s,console.log("-->setCurrentTeamByName(): Team set to "+e);break}}},e.prototype.loadNewsStories=function(){console.log("-->loadNewsStories()..");var e=this.getHome();return this._http.get(e+"/stories").map(function(e){return e.json()})},e.prototype.setNews=function(e){console.log("->setNews()...recieved news stories: "+e),this.dsNewsStories=e},e.prototype.handleError=function(e){var t=e.message?e.message:e.status?e.status+" - "+e.statusText:"Server error";console.error(t)},e.prototype.getHome=function(){var e;return this.CurrentServerMode==this.modes.LOCAL?e="http://localhost:8080/clubRegisterApp":this.CurrentServerMode==this.modes.REMOTE&&(e="http://www.avenueunited.ie"),console.log("getHome() returning: "+e),e},e.prototype.dsGetTeams=function(){var e=this;console.log("--> dsGetTeams()..");var t=this.getHome();return this._http.get(t+"/teams").map(function(e){return e.json()}).subscribe(function(t){return e.dsSetTeams(t)},function(e){return console.error("DataService: ERROR reading teams from server!")},function(){return console.log(" <== Teams received from server <==")})},e.prototype.dsSetTeams=function(e){console.log("-->dsSetTeams()"),this.dsTeams=e},e.prototype.loadCurrentTeamMembersByName=function(e){if(console.log("-->loadCurrentTeamMembersByName("+e+")"),0!==this.dsTeamMembers.length&&this.dsCurrentTeam.name==e)return void console.log("-->loadCurrentTeamByName():Members already loaded not loading again!");this.dsTeamMembers.length=0;var t=this.getHome();this._http.get(t+"/team/"+e).map(function(e){return e.json()})},e.prototype.getTeamDetailsSim=function(e){return this.dsCurrentTeam},e.prototype.loadCurrentSponsors=function(){return console.log("-->loadCurrentSponsors()"),this.dsSponsors=[{name:"Enzo's Takeaway",image:"resources/images/adverts/enzos.png"},{name:"Rochford's Pharmacy",image:"resources/images/adverts/main-sponsor.png"},{name:"Ennis Cabs",image:"resources/images/adverts/ec.png"}],this.dsSponsors},e.prototype.clearCurrentMember=function(){this.dsCurrentMember=null},e.prototype.loadPhotoDetails=function(e){return console.log("-->loadPhotoDetails("+e+")"),this._http.get(e).map(function(e){return e.json()})},e.prototype.authenticate=function(e,t){console.log("-->authenticate("+e+","+t+")");var r="j_username="+e+"&j_password="+t,s=JSON.stringify({creds:r}),o=new n.Headers({"Content-Type":"application/json"}),a=new i.RequestOptions({headers:o});return this._http.post(this.getHome()+"/j_spring_security_check?"+r,s,a)},e.prototype.getUser=function(e){return console.log("-->getUser("+e+")"),this._http.get(this.getHome()+"/admin/user").map(function(e){return e.json()})},e.prototype.logout=function(){return this.dsAuthenticated=!1,this._http.get(this.getHome()+"/j_spring_security_logout")},e.prototype.dsGetAllMembers=function(){var e=this;console.log("-->dsGetAllMembers()");var t=this.getHome();return this._http.get(t+"/admin/members").map(function(e){return e.json()}).subscribe(function(t){return e.dsAllMembers=t},function(e){return console.log("ERROR getting members from server!")},function(){return console.log("<== Finished getting all members from server <==")})},e.prototype.getTeamNameFrmId=function(e){for(var t="",r=0;r<this.dsTeams.length;r++)if(e==r)return t=this.dsTeams[r-1].name;return t},e.prototype.saveJwt=function(e){e&&localStorage.setItem("id_token",e)},e.prototype.setLogHdr=function(e,t){console.log("** [Logger Service] Setting log header for ["+t+"]");var r=0,s=4*e,o=25,n="## "+t;if(n.length<o){var i=o-n.length,a=0;for(a=0;a<i;a++)n+=" "}for(r=0;r<s;r++)n+=" ";return n+="|-"},e=l([r.Injectable(),f(0,s.Inject(o.Http)),p("design:paramtypes",[a.LoggerService,o.Http])],e)}(),e("SessionDataService",c)}}});